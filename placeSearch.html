<!DOCTYPE html>
<html>

<head>
  <title>Place searches</title>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <style>
    /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */

    #map {
      height: 100%;
      width: 100%;
    }

    /* Optional: Makes the sample page fill the window. */

    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>

</head>

<body>
  <div>
    <input type="button" value="Generate Map" onclick="StaticMap()" />
  </div>
  <div id="map"></div>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCP3ePEvxjrmCXKZ0Z-_5buf2cKsiGai_s &libraries=places" async defer></script>
  <script>
    var map;
    var infowindow;
    var locations = [0,1,2];
    var myPos;

    function initMap(value, callback) {

      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: -34.397, lng: 150.644 },
        zoom: 14
      });
      infoWindow = new google.maps.InfoWindow;
      // Try HTML5 geolocation.
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          var pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };
          myPos = pos;
          infoWindow.setPosition(pos);
          infoWindow.setContent("You are here");
          infoWindow.open(map);
          map.setCenter(pos);

          var service = new google.maps.places.PlacesService(map);
          service.nearbySearch({
            location: pos,
            radius: 4000,
            type: value

          }, callback);
        }, function() {
          handleLocationError(true, infoWindow, map.getCenter());
        });
      }
      else {
        // Browser doesn't support Geolocation
        handleLocationError(false, infoWindow, map.getCenter());
      }
    }


    function createMarker(place) {
      var placeLoc = place.geometry.location;
      var marker = new google.maps.Marker({
        map: map,
        position: place.geometry.location
      });

      google.maps.event.addListener(marker, 'click', function() {
        infoWindow.setContent(place.name);
        infoWindow.open(map, this);
      });
    }

    function StaticMap() {
      var places = ["gas_station", "hospital", "lodging"];
      var tmpurl = "https://maps.googleapis.com/maps/api/staticmap?center=";
      var flag = false;
      var count = 1;
      var alph = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"];
      var colorArray = ["red", "green", "yellow"];
      for (var i = 0; i < places.length; i++) {
        initMap(places[i], function(results, status) {
          if(flag === false) {
            tmpurl += myPos.lat + "," + myPos.lng + "&zoom=13&maptype=hybrid&size=640x640&markers=color:blue%7Clabel:A%7C" + myPos.lat + "," + myPos.lng;
            flag = true;
          }
          
          if (status === google.maps.places.PlacesServiceStatus.OK) {
            for (var j = 0; j < results.length; j++) {
              createMarker(results[j]);
            }
          }
          for(var z = 0; z < results[0].types.length; z++) {
            if(results[0].types[z] == "gas_station") {
              locations[0] = results;
            } else if(results[0].types[z] == "hospital") {
              locations[1] = results;
            } else if(results[2].types[z] == "lodging") {
              locations[2] = results;
            }
          }
          console.log(locations);
          
          if(places.length == count) {
            console.log("locations.length = " + locations.length);
            console.log("location[0].length = " + locations[0].length);
            for (var k = 0; k < locations.length; k++) {
              for (var l = 0; l < locations[k].length; l++) {
                console.log("Color: " + colorArray[k] + " Letter: " + alph[l] + " Address: " + locations[k][l].vicinity);
                tmpurl += "&markers=color:" + colorArray[k] + "%7Clabel:" + alph[l] + "%7C" + locations[k][l].geometry.location.lat() + "," + locations[k][l].geometry.location.lng();
              }
            }
            console.log(tmpurl);
          }
          count++;
        });
        
        
      }
    }
    
  </script>

</body>

</html>